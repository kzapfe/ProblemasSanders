%\documentclass[letterpaper,10pt, jcp, aps]{revtex4-1}
\documentclass[superscriptaddress,pre,reprint,showpacs,onecolumn]{revtex4-1}

\usepackage[utf8]{inputenc}
\usepackage{amsmath, amsfonts}
\usepackage{graphicx}
\usepackage{natbib}
\usepackage{caption}
\usepackage{subcaption}
%\usepackage{authblk} parece ser que ya esta metido cuando usas preprint

\usepackage{hyperref}


%\bibliographystyle{alpha}

%opening

%\author{Rosa Rodríguez \& David P.~Sanders \& W. P. K. Zapfe}
%\affil{Departamento de Física, Facultad de Ciencias, Universidad Nacional Autónoma de México, Ciudad Universitaria, Del.~Coyoacán, México D.F. 04510, Mexico}

\usepackage{mathptmx}
% I dont know if that package is compatible with revtex.

\newcommand{\defeq}{:=}
\newcommand{\mean}[1]{\left \langle #1 \right \rangle}
\newcommand{\rd}[1]{\mathrm{d}{#1} \,}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\vv}{\mathbf{v}}
\newcommand{\indicatorsymbol}{\mathbf{1}}
\newcommand{\indicator}[1]{\indicatorsymbol_{ \{   #1 \} } } 
\newcommand{\etal}{et al.\ } 

\setlength{\parskip}{10pt}
\setlength{\parindent}{0pt}


\begin{document}

\title{Exact hopping \dots appendix more dimensions}

\section{Generalizations}

We shall generalize the above procedures to more
complex cases. There are two possible complexifications: one is
to think in n-dimensional balls in an n-dimensional space, and the
other is augment the number of balls. In this appendix we shall deal
with the former. 

\section{More Dimensions}

\subsection{Volume}

We modify the notation a little in order to generalize. We shall
call the balls $X$ and $Y$ instead of $1$ and $2$. We have $n$ coordinates
for the center of each ball, so the coordinates of the first ball will be
$x_1, x_2, \ldots x_n$, and the second will have center coordinates
$y_1, y_2, \ldots y_n$. We denote the sizes of the box as $h_1, h_2 , \ldots h_n$
and we can procede as before:
\begin{align*}
  a_1&=h_1/2-r & a_2 =h_2/2-r &\\
  &\cdots &       a_n=h_n/2-r &
  \end{align*}
We can call these $h_k$ quantities the ``effective half sizes'' of the box.
The collition condition is, of course:
\begin{equation}
  \sqrt{\sum_j (x_j-y_j)^2} = 2r
\end{equation}

We peform a similar rotation of coordinates as in the 2-dimensional case:
\begin{align}
  z_j & = (x_j-y_j)/2  &\\
  w_j & =(x_j+y_j)/2 , &
\end{align}
so that the collision conditon reads
\begin{equation}
  \sum_{j=1}^n z_j^2=2r.
\end{equation}
We will now procede to calculate the total ``effective Volume'':
\begin{equation}
V_{box}=2^{2n}=\prod_{j=1}^n a_j^2
\end{equation}
to which we substract:
\begin{equation}
  V_{exc}=\prod_{j=1}^n \iint_{-a_j}^{a_j} \rd{x_j} \rd{y_j} \indicator{Z^C} (x,y)
\end{equation}
Here we define the symbol:
\begin{equation*}
  \prod_{j=1}^n\iint_{-a_j}^{a_j} \rd{x_j} \rd{y_j} 
\end{equation*}
as shorthand for the integral operator over the avaiable space:
\begin{equation*}
  \int_{ -a_1 } ^{a_1} \rd{x_1}  \int_{-a_1 }^{a_1} \rd{y_1}
  \cdots
  \int_{-a_n }^{a_n} \rd{x_n}  \int_{-a_n } ^{a_1} \rd{y_n}
\end{equation*}
The excluded set is
\begin{equation}
  Z^c= \biggl\lbrace (x,y) \vert \sqrt{\left( \sum_{j=1}^n (x_j - y_j )^2 \right)} \leq 2 r \biggr\rbrace
\end{equation}
We change those expressions to the $(w, z)$ coordinates. The excluded volume
then reads as:
\begin{equation}
  V_{exc} =  \prod_{j=1}^n \int_{-\sqrt{2}a_j} ^{\sqrt{2}a_j} \rd{z_j}
  \int_{-\sqrt{2}a_j+|x_j|} ^{\sqrt{2}a_j-|z_j|} \rd{w_j} \indicator{Z^C}
\end{equation}
Again, the Integrand doesn't depend on the $w$ coordinates:
\begin{equation}
  V_{exc} = 2^n \prod_{j=1}^n \int_{-\sqrt{2}a_j} ^{\sqrt{2}a_j} \rd{z_j}
  \prod_{k=1}^n (\sqrt{2}a_j-|z_k|) \indicator{Z^C}.
\end{equation}
The integrand is an even function, so:
\begin{equation}
  V_{exc} = 2^{2n} \prod_{j=1}^n \int_{0} ^{\sqrt{2}a_j} \rd{z_j}
  \prod_{k=1}^n (\sqrt{2}a_j-z_k) \indicator{Z^C}.
\end{equation}

We assume for simplicity that all hopping is possible,
\begin{equation}
  0 < r \leq \min_j {h_j/4}
\end{equation}
We notice that the structure is the same as in the two dimensional case,
so that we may be able to use n-dimensional spherical coordinates:

\begin{equation}
  \begin{split}
    z_1 & =\rho \cos \phi_1 \\
    z_2 & =\rho \sin \phi_1 \cos \phi_2 \\
     z_2 & =\rho \sin \phi_1 \sin \phi_2 \cos \phi_2 \\
    \vdots & \\
    z_n & = \rho \sin \phi_1 \cdots \sin \phi_{n-1}
  \end{split}
\end{equation}
That results in:
\begin{equation}
  V_{exl}=2^{2n} \prod_{j=1}^{n-1} \int_0^{\pi/2} \rd{\phi_j}
  \int_0^r \rd{\rho} \rho^{n-1} \sin^{n-2-j}(\phi_j)
  \prod_{k=1}^n (\sqrt{2}a_j -z_j(\rho, \phi)) 
\end{equation}

The integral will have for given n a specific combination of powers
of trigonometric functions, that are all solvable analitycally, and have
to result in symmetric expressions in all the $a_j$ parameters. As
a realistic example we solve the case for $n=3$.

\begin{equation}
  V_{exl}=2^{2\cdot 3} \iiint_0^ {\sqrt{2} a_j} \rd{z_1} \rd{z_2}  \rd{z_3} 
  (\sqrt{2}a_1 -z_1)(\sqrt{2}a_2 -z_2)(\sqrt{2}a_3-z_3) \indicator{Z^C}
\end{equation}

\begin{multline}
  V_{exl} = 64 \iiint_0^ {\sqrt{2} a_j} \rd{z_1} \rd{z_2}  \rd{z_3} 
  \bigg( 2\sqrt{2}a_1 a_2 a_3
  -2(a_1 a_2 z_3 +a_2 a_3 z_1 +a_3 a_1 z_2) \\
   +\sqrt{2}(a_1 z_2 z_3+a_2 z_3 z_1+a_3 z_1 z_2)
   -z_1 z _2 z_3 )
  \bigg)
\end{multline}

Changing to spherical:
\begin{equation}
  \begin{split}
    z_1 & =\rho \cos \phi_1 \\
    z_2 & =\rho \sin \phi_1 \cos \phi_2 \\
     z_2 & =\rho \sin \phi_1 \sin \phi_2 
  \end{split}
\end{equation}

and substiting:
  \begin{multline}
  \frac{V_{exl}}{64}= \int_0^r \rd{\rho}
  \int_0^{\pi/2} \rd{\phi_1}   \int_0^{\pi/2} \rd{\phi_2}
  \rho^2 \sin\phi_1
  \bigg( 2*\sqrt{2} a_1 a_2 a_3 \\
  -2 \rho  ( a_1 a_2 \sin \phi_1 \sin \phi_2
  +a_2 a_3 \cos \phi_1 + a_3 a_1 \sin \phi_1 \cos \phi_2) \\
  +\sqrt{2} \rho^2( a_1 \sin^2\phi_1 \cos\phi_2 \sin\phi_2 
  a_2 \cos \phi_1 \sin phi_1 \sin\phi_2 
  + a_3 \cos \phi_1 \sin phi_1 \cos \phi_2 ) \\
  -\rho^3  \cos\phi_1 \sin^2\phi_1 \cos\phi_2 \sin\phi_2 
  \bigg)
   \end{multline}
The integral consist of only exercices for Calculo II, so its very treatable, and gives
\begin{equation}
  \frac{V_{exl}}{64}= 8 \bigg(
   r^3 a_1 a_2 a_3 \frac{\pi}{6}
  - r^4/4 \frac{\pi}{4} (a_1 a_2 +a_2 a_3 + a_3 a_1)
  +  r^5/20 (a_1 + a_2 + a_3)
  -  r^6/48 \bigg).
\end{equation}

\subsection{Hopping Area}

It turns out that by following the upper formalism, it is rather
straightforward to calculate the excluded area for the hopping area
cross section. Let us say that we want to hopp in the $k$ axis:

\begin{equation}
  \begin{split}
    A_{exc} 
   &  =  \prod_{j=1}^n \iint_{-a_j}^{a_j} \rd{x_j} \rd{y_j} \indicator{Z^C} (x,y)
    \delta \big(\frac{x_k-y_k}{\sqrt{2}}\big) \\
    &  =  \prod_{j=1}^n \int_{-\sqrt{2} a_j}^{\sqrt{2}a_j} \rd{z_j}
\int_{-\sqrt{2} a_j+|z_j|}^{\sqrt{2}a_j-|z_j|} \rd{w_j}
 \indicator{Z^C} (z,w)
    \delta (z_k) \\
        &  = 2^n \prod_{j=1}^n \int_{-\sqrt{2} a_j}^{\sqrt{2}a_j} \rd{z_j}
 \prod_{l=1}^n (\sqrt{2}a_l-|z_l|)
 \indicator{Z^C} (z)
    \delta (z_j) 
  \end{split}
\end{equation}

Without loss of generality, we can set $k=1$

\begin{equation}
  \begin{split}
    A_{exc} &=  2^n \int_{-\sqrt{2}a_1}^{\sqrt{2}a_1} \rd{z_1} \rd{z_1}
    \prod_{j=2}^n \int_{-\sqrt{2} a_j}^{\sqrt{2}a_j} \rd{z_j}
    \prod_{l=2}^n (\sqrt{2}a_l-|z_l|)
    \indicator{Z^C} (z)
    \delta (z_j) \\
    &= 2^n\ \sqrt{2}a_1    \prod_{j=2}^n \int_{-\sqrt{2} a_j}^{\sqrt{2}a_j} \rd{z_j}
    \prod_{l=2}^n (\sqrt{2}a_l-|z_l|)
    \indicator{Z^C} (z) \\
    &= 2\ \sqrt{2}a_1  2^{n-1}  \prod_{j=2}^n \int_{-\sqrt{2} a_j}^{\sqrt{2}a_j} \rd{z_j}
     \prod_{l=2}^n (\sqrt{2}a_l-|z_l|)
    \indicator{Z^C} (z) 
  \end{split}
\end{equation}

It can be seen that this has the structure of the excluded volume
for $n-1$ dimensional balls, so we can say that, by using the other
$n-1$ axes, we end up with:
\begin{equation}
  A_{exc,n}=2 \sqrt{2}a_1V_{exc,n-1}(a_2,\ldots,a_n)
\end{equation}
Remember that this is the excluded part. The real cross
section area would take
the ``whole'' area and to substract this term:
\begin{equation}
  \begin{split}
    A_{hop,n}  = & 2^{2n-1}\sqrt{2}a_1\prod_{j=2}^n a_j^2-A_{exc,n} \\
      = & 2 \sqrt{2}a_1 (V_{tot,n-1} - V_{exc,n-1})
  \end{split} 
\end{equation}
Which has a nice rhyme to the Machta Zwanzig Formula in the substitution
for Volume and Area \ldots

\section{Collition cross section area}

The expression for the Cross Section Area that represents the collition
between spheres or disks is the following:
\begin{equation}
  A_{c}=  \prod_{j=1}^n\iint_{-a_j}^{a_j} \rd{x_j} \rd{y_j}
  \indicator{Z^C}
  \delta (\sqrt{\sum_j (x_j-y_j)^2} - (2r))
\end{equation}
In the collition of two disk the condition denoted by the indicator function
becomes irrelevant. We can argue that the collition is the ``edge'' case
of the avaible volume and so we can integrate over the the whole space,
as the Dirac delta representing the collition takes care that we are
marginally on the permited space. We can proceed taking this into
account and change to the $z_j, w_j$ corrdinates:
\begin{equation}
  \begin{split}
  A_{c} & =  \prod_{j=1}^n\int_{-\sqrt{2}a_j}^{\sqrt{2}a_j} \rd{z_j}
  \int_{-\sqrt{2}a_j+|z_j|}^{\sqrt{2}a_j-|z_j|} \rd{w_j}
  \delta (\sqrt{2 \sum_j (z_j)^2} - (2r)) \\
  & = 2^n \prod_{j=1}^n\int_{-\sqrt{2}a_j}^{\sqrt{2}a_j} \rd{z_j}
  \prod_k^n(\sqrt{2} a_k -|z_k|)
  \delta (\sqrt{2 \sum_j (z_j)^2} - (2r))
  \end{split}
\end{equation}
This again, is simpler to solve in n-dimensional spherical coordinates,
where the function inside the Dirac Delta becomes a simple linear expresion.
In the 3D case we restrict us to the case where all hoping is posible, so that
the space does not split into disjoint components, and all sides of the spheres
are avaible for collition. Otherwise, dificult to visualize conditions arise
on the integration limits. We call such maximal radius $r_f$ and asumme $r<r_f$.
\begin{equation}
    A_{c}/8=\int_0^{r_f} \rho^2 \rd \rho \delta(\sqrt{2} \rho - 2r)
      8 \iint_0^{\pi/2} \rd \phi_1 \rd \phi_2 \sin \phi_1
      (\sqrt{2}a_1-\rho \cos \phi_1)
      (\sqrt{2}a_2-\rho \sin \phi_1 \cos \phi_2)
      (\sqrt{2}a_3-\rho \sin \phi_1 \sin \phi_2)
\end{equation}
The integration is tedious but feasible, and after a little algebra it gives:
\begin{equation}
  A_{col}=64 ( 2 \pi r^2 a_1a_2a_3 -  \pi r^3 (a_1a_2 +a_2a_3 + a_3 a_1)
  +4r^4/3 (a_1+a_2+a_3)
  -r^5/2)
\end{equation}

\section{Collition against a Wall}

The collition against a Wall can also be expressed by means of a Dirac Delta.
Without loss of generality, we can assume that we want the $X$ ball to hit
the ``right'' (positive direction) wall in direction n, that is expressed
as:
\begin{equation}
x_n-a=0   
\end{equation}
The integral that represents that Area then would be:

\begin{equation}
  A_W=\prod_j^n \int_{-a_j}^{a_j} \rd x_j \rd y_j
  \indicator{Z} \delta(x_n-a_n)
\end{equation}

Once more, is simpler to ignore the indicator function, as if the
balls could overlap, calculate this ``excesive area'' and then substract
the integral with the indicator function of the complementary set, $Z^C$.
We start with the unrestrained integral:
\begin{equation}
  A_{WF}=\prod_j^n \int_{-a_j}^{a_j} \rd x_j \rd y_j \delta(x_n -a_n)
\end{equation}
This is straightforward to solve and it gives as expected:
\begin{equation}
  A_{WF}=2^{2n-1} a_n \prod_{j=1}^{n-1} a_j^2
\end{equation}
The complementary set is a bit more tedious but not impossible to solve:
\begin{equation}
  \begin{split}
  A_{WC} & =\prod_j^n \int_{-a_j}^{a_j} \rd x_j \rd y_j
  \indicator{\sqrt{\sum_k (x_k-y_k)^2 }\leq 2 r} \delta(x_n-a_n)  \\
  & = \int_{-a_n}^{a_n} \prod{j=1}^{n-1} \int_{-a_j}^{a_j} \rd x_j \rd y_j
  \indicator{\sqrt{(a_n - y_n)^2 +\sum_k^{n-1} (x_k-y_k)^2 }\leq 2 r}
  \end{split}
\end{equation}
  The Condition of the indicator function can be translated to a
  new limit of integration in the $\int \rd y_n$ operator:
  \begin{equation}
    4 r^2 -\sum_{k}^{n-1} (x_k - y_k) ^2 \geq ( a_n - y_n )^2
  \end{equation}
  Let $u = a - y_n $, $\rd u = -\rd y$:
  \begin{equation}
    \begin{split}
      A_{WC}& =\int_0^{\sqrt{4r^2-\Sigma}} \rd u  \prod_j^{n_1} \int_{-a_j}^{a_j} \rd x_j \rd y_j
        \indicator{\sqrt{\sum_k^{n-1} (x_k -y_k)^2} \leq 2 r}\\ 
      & = \prod_j^{n_1} \int_{-a_j}^{a_j} \rd x_j \rd y_j \sqrt{4 r^2 - \sum_k^{n-} (x_k-y_k)^2}  
        \indicator{\sqrt{\sum_k^{n-1} (x_k -y_k)^2} \leq 2 r} 
    \end{split}
    \end{equation}
  This, again, can be set to the $w_j, z_j$ coordinates:
  \begin{equation}
    \begin{split}
      A_{WC}& =  \prod_j^{n_1} \int_{-\sqrt{2}a_j}^{\sqrt{2}a_j} \rd w_j \rd z_j
      \sqrt{4 r^2 - \sum_k^{n-} 2 z^2}  
        \indicator{\sqrt{\sum_k^{n-1} 2 z^2} \leq 2 r}\\ 
        & =  \prod_j^{n_1} \int_{-\sqrt{2}a_j}^{\sqrt{2}a_j}  \rd z_j
        \sqrt{4 r^2 - \sum_k^{n-} 2 z^2} \prod_k^{n-1} 2 ( \sqrt{2}a_k - |z_k| ) 
        \indicator{\sqrt{\sum_k^{n-1} 2 z^2} \leq 2 r}
    \end{split}
  \end{equation}
  We take the $2$ factors out of the integrand.
  The indicator function can be made also a new limit of integration over
  spherical coordinates, stating the maximal possible radius. As the function
  is even in all $z_k$ coordinates, we can integrate over a ``$2^n$-tant'' of a sphere.
  Remember that we have a coordinate less that has allready been integrated, so
  it is a $n-1$ dimensional sphere element. We call it $O$ for generalizated octant:
  \begin{equation}
    A_{WC}/2^{n-1}=\int_0^{\sqrt{2}r} \rho^{n-2} \rd \rho \int_O \rd \Omega^{n-1}
    \sqrt{2}\sqrt{2 r^2 - \rho^2} \prod (\sqrt{2}a_k - z_k(\rho, \Omega)).
  \end{equation}
  This expression can actually be solved in terms of hypergeometric functions,
  but we shall focus ourselves in the 3D case right now:
  \begin{equation}
    A_{WC}/(4\sqrt{2})=\int_0^{\sqrt{2}r} \rho^{n-2} \rd \rho \int_0^{\pi/2} \rd \phi
    \sqrt{2}\sqrt{2 r^2 - \rho^2} (2 a_1 a_2 -\sqrt{2} \rho (a_1 \sin \phi+ a_2 \cos\phi)
    +\rho^2 \sin\phi \cos\phi)
  \end{equation}
  This integral is not horrible and after a little blackboard work it gives:
  \begin{equation}
    A_{WC}= 64 \pi a_1 a_2 r^3 - 4\pi r^4 (a_1 +a_2) + 65/15 r^5.
  \end{equation}
  This has to be substracted to the ``unrestricted area''.


\section{Maximal possible radius}

If the box in any direction is at least two times the size of any of
the other directions, then the maximal avaible radius is half the smaller
size of the box. Without loss of generality let us say that the box has
the larger size twice the smaller size and all the other sides have
sizes in between. Then you can fit two spheres side to side along this
axis and they would touch the walls perpendicular to the smaller size.
The other dimensions, being larger than this smaller side, would not
inerfere, but is impossible to make the spheres larger without
breaking the smallest side rule.

The complicated case comes when all sides are less than twice
the smaller side. Without loss of generality we can thing that the sides
are arranged from smallest to biggest:

\begin{equation}\label{ordens}
  h_1 \geq h_2 \cdots \geq h_d < 2 h_2
\end{equation}

Let us label $q_j,1$ and $q_j,2$ the $j$-th coordinate of sphere 1 and 2,
respectively. All coordinates are cartesian and the origin is on the
center of the box, and the box is alligned with the axes in such a way
that each side is parallel to the axes in which it spawns and perpendicular
to the other one. 

The largest possible spheres have to touch each other:
\begin{equation}\label{touchin}
  \sum_{j=1}(q_{j,1}-q_{j_2})^2=(2 r)^2
\end{equation}

Also, if the condition in the equality \ref{ordens} is meet, then
it is possible to acomodate the spheres so that they touch opposite walls in
each direction. We can set them in a way so that the sphere 1 touches the
``positive'' walls and the sphere 2 touches the ``negative'' walls:
\begin{align}\label{pared1}
  q_{j,1}+r & =h_j/2 & q_{j,2}-r & =-h_j/2 &
\end{align}
Substracting the right equations from the left equations in \ref{pared1}
and reordering the terms gives:
\begin{align}
  q_{j,1}-q_{j,2}=h_j-2r
\end{align}
Substituting the last expression into \ref{touchin}:
\begin{equation}
  \sum_j(h_j-2r)^2=(2r)^2
\end{equation}
After a little algebra that gives:
\begin{equation}
  \sum_j h_j^2 -4r\sum_j h_j + 4(d-1)r^2=0
\end{equation}
That can be solved using the general quadratic formula.
It turns out that the smaller solution is the correct one. The other
inverts the position of the spheres and gives spheres that while
touching opposite walls and each other, have centers outside the box.
\begin{equation}\label{rmax}
  r=\frac{\sum_j h_j - \sqrt{\sum_{j\neq k}h_j h_k-(d-2)\sum_j{h_j^2}}}{2(d-1)}
\end{equation}
That is the biggest possible radius for the spheres.
The biggest possible radius in which hopping along some axis is still
posible is the biggest possible radius for a box in (d-1) dimensions
( or the biggest possible radius in total, whichever is smaller),
taking the other axes as parameters. That is because that would allow
the spheres to just pass each other along the aforementioned axis.



\end{document}
